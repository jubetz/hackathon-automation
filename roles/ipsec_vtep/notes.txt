For CL 4.2.1

1) Need to build strongswan from source so that we can enable gcm. So dumb.
  sudo apt-get install -y gcc-multilib libgmp-dev libssl-dev strongswan strongswan-swanctl -o Acquire::ForceIPv4=true 
  wget https://download.strongswan.org/strongswan-5.7.2.tar.bz2
  cd strongswan-5.7.2/
  ./configure --prefix=/usr --sysconfdir=/etc --enable-aesni --enable-ccm --enable-chapoly --enable-gcm --enable-openssl
  sudo make
  sudo make install

2) Then, need to modify the strongswan systemd service file to stick "ip vrf exec default" in front of all of the ipsec commands

  sudo nano /lib/systemd/system/strongswan.service
  sudo systemctl daemon-reload
  sudo systemctl stop strongswan
  sudo ipsec stop

3) Drop in config into /etc/swanctl/swanctl.conf

connections {

   leaf02-leaf01 {
      local_addrs  = 10.0.1.2
      remote_addrs = 10.0.1.1

      local {
         auth = psk
         id = leaf02
      }
      remote {
         auth = psk
         id = leaf01
      }
      children {
         vxlan {
            start_action = start
            esp_proposals = aes128gcm96-modp4096
            mode = transport
         }
      }
      version = 2
      proposals = aes128gcm96-prfsha384-modp4096
   }

   leaf02-leaf03 {
      local_addrs  = 10.0.1.2
      remote_addrs = 10.0.1.3

      local {
         auth = psk
         id = leaf02
      }
      remote {
         auth = psk
         id = leaf03
      }
      children {
         vxlan {
            start_action = start
            esp_proposals = aes128gcm96-modp4096
            mode = transport
         }
      }
      version = 2
      proposals = aes128gcm96-prfsha384-modp4096
   }

}

secrets {
    ike-1 {
        id = *
        secret = cumulus
    }
}

4) Remove default route from mgmt vrf
5) add default route pointing out fabric links
6) start strongswan
7) Perform a sudo swanctl -q to load the config.


